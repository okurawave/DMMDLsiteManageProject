承知いたしました。これまでの対話を基に、アプリケーション「My Doujin Vault（仮称）」の完全な要件定義書を作成します。これは、企画者、デザイナー、開発者の全員が共通認識を持つための設計図となるものです。

---

## **アプリケーション「My Doujin Vault」要件定義書**

**Ver. 1.0**
**作成日: 2025年8月8日**

### 1. 概要

#### 1.1. プロジェクト名
My Doujin Vault （マイ・ドウジン・ヴォールト）

#### 1.2. 目的と背景
現在、多くのユーザーがDLsite、Fanzaなどの複数のプラットフォームでデジタル同人コンテンツを購入している。しかし、購入した作品は各プラットフォームに分散し、コレクション全体を横断的に把握・管理する公式な手段が存在しない。これにより、「同じ作品を重複して購入してしまう」「過去に購入した作品を探し出すのが困難」といった問題が発生している。
本プロジェクトは、これらの分散した購入情報を一元的に集約・管理できるアプリケーションを提供し、ユーザーに快適で豊かなデジタルコレクション体験を提供することを目的とする。

#### 1.3. プロジェクトスコープ
**【スコープ内（開発対象）】**
*   iOS/Androidで動作するネイティブアプリケーションの開発。
*   主要なWebブラウザで動作するWebアプリケーションの開発。
*   ユーザーアカウントシステムと、登録データを複数デバイスで同期する機能。
*   作品情報の手動登録・編集・閲覧・削除機能。
*   作品を快適に探すための検索・ソート・フィルタリング機能。
*   PCブラウザから作品情報を半自動で登録するためのブラウザ拡張機能の開発。

**【スコープ外（開発しない）】**
*   作品ファイル自体のダウンロード、管理、閲覧機能（アプリはあくまで書誌情報の管理に特化する）。
*   プラットフォームとの決済連携機能。
*   ユーザー間でのコミュニケーション機能。
*   公式APIを利用した完全自動での購入履歴同期（現時点で公式APIが存在しないため）。

### 2. システム構成

#### 2.1. アーキテクチャ概要
本システムは、クライアントアプリケーション（iOS/Android/Web/ブラウザ拡張機能）と、バックエンドサービス（BaaS）で構成される。

*   **クライアント**: React Native + Expo (Expo Router) を採用し、単一のコードベースからiOS, Android, Webアプリケーションをビルドする。ブラウザ拡張機能は別途Web標準技術で開発する。
*   **バックエンド**: Google Firebase を全面的に採用する。
    *   **データベース**: Cloud Firestore
    *   **認証**: Firebase Authentication
    *   **ストレージ**: Cloud Storage (表紙画像などのホスティング用)
    *   **ホスティング**: Firebase Hosting (Webアプリケーションのデプロイ先)

#### 2.2. 技術スタック
*   **フロントエンド**: React Native, Expo, TypeScript
*   **バックエンド**: Firebase (Firestore, Authentication, Storage, Hosting)
*   **状態管理**: Zustand または Redux Toolkit
*   **ナビゲーション**: Expo Router
*   **ブラウザ拡張機能**: HTML, CSS, JavaScript (TypeScript)

### 3. 機能要件

#### 3.1. データモデル
##### 3.1.1. 作品 (Work) データモデル
Cloud Firestoreに保存される作品ドキュメントの構造。

| フィールド名      | データ型            | 説明                                                              | 例                                  |
| ----------------- | ------------------- | ----------------------------------------------------------------- | ----------------------------------- |
| `id`              | `string`            | Firestoreが自動生成するユニークID                                 | `aK2j...`                           |
| `userId`          | `string`            | この作品を所有するユーザーのID (Firebase AuthのUID)               | `gH5f...`                           |
| `title`           | `string`            | 作品タイトル (必須)                                               | `異世界転生したら〇〇だった件`        |
| `circleName`      | `string`            | サークル名                                                        | `スタジオ△△`                       |
| `authorName`      | `string`            | 作者名                                                            | `山田太郎`                          |
| `platform`        | `string`            | 購入プラットフォーム (必須) ("DLsite", "Fanza", "その他" から選択) | `DLsite`                            |
| `productUrl`      | `string`            | 作品の公式販売ページのURL                                         | `https://www.dlsite.com/home/...`     |
| `coverImageUrl`   | `string`            | 表紙画像のURL (拡張機能で取得 or ユーザーが手動で設定)            | `https://.../img.jpg`               |
| `tags`            | `array<string>`     | ユーザーが自由につけるタグ                                        | `["RPG", "ファンタジー", "獣人"]`     |
| `rating`          | `number`            | ユーザーによる評価 (0-5の整数)                                    | `5`                                 |
| `status`          | `string`            | 作品の状態 (必須) ("未読", "読了", "プレイ中", "積読" などから選択) | `未読`                              |
| `purchaseDate`    | `timestamp`         | 購入日                                                            | `2025-08-01`                        |
| `price`           | `number`            | 価格（円）                                                        | `1200`                              |
| `note`            | `string`            | 自由記述メモ                                                      | `続編に期待。`                      |
| `createdAt`       | `timestamp`         | データ作成日時                                                    | `2025-08-08T12:00:00Z`              |
| `updatedAt`       | `timestamp`         | データ更新日時                                                    | `2025-08-08T12:00:00Z`              |

#### 3.2. ユーザー管理機能 (Firebase Authentication)
*   **3.2.1. アカウント作成**: メールアドレスとパスワードによる新規登録ができる。
*   **3.2.2. ログイン**: 登録したメールアドレスとパスワードでログインできる。
*   **3.2.3. ソーシャルログイン**: Googleアカウントを使用したログイン・新規登録ができる。
*   **3.2.4. ログアウト**: アプリケーションからログアウトできる。
*   **3.2.5. パスワードリセット**: 登録したメールアドレス宛に、パスワード再設定用のリンクを送信できる。
*   **3.2.6. アカウント削除**: ユーザーは自身の全データ（登録作品情報を含む）を削除し、退会できる。実行前に警告と最終確認を行う。

#### 3.3. 作品管理（CRUD）機能
*   **3.3.1. 作品登録 (Create)**:
    *   手動入力フォームから作品情報を登録できる（データモデル参照）。
    *   `title` と `platform`、`status` は必須項目とする。
    *   表紙画像はURLを指定するか、デバイスから画像をアップロードできる（アップロードされた画像はCloud Storageに保存）。
*   **3.3.2. 作品閲覧 (Read)**:
    *   **一覧表示画面**: 登録した全作品をリスト形式またはグリッド（表紙画像）形式で表示できる。表示形式の切り替えが可能。
    *   **詳細表示画面**: 一覧から作品を選択すると、その作品の全情報を表示する画面に遷移する。
*   **3.3.3. 作品更新 (Update)**: 詳細表示画面から、登録済みの作品情報を編集できる。
*   **3.3.4. 作品削除 (Delete)**: 作品をライブラリから削除できる。削除前には確認ダイアログを表示する。

#### 3.4. ライブラリ機能
*   **3.4.1. 横断検索**:
    *   `title`, `circleName`, `authorName`, `tags` を対象にしたキーワード検索ができる。
    *   検索結果はリアルタイムで絞り込まれる。
*   **3.4.2. ソート機能**:
    *   一覧表示画面で、作品を以下の条件で並べ替えできる。
        *   購入日（新しい順/古い順）
        *   タイトル（昇順/降順）
        *   評価（高い順/低い順）
        *   データ登録日（新しい順/古い順）
*   **3.4.3. フィルタリング機能**:
    *   以下の条件を組み合わせて作品を絞り込める。
        *   購入プラットフォーム
        *   ステータス
        *   評価（例: 星3以上）
        *   タグ

#### 3.5. ブラウザ拡張機能
*   **3.5.1. 対応ブラウザ**: Google Chrome (Manifest V3)
*   **3.5.2. 対応サイト**: DLsite (home/maniax/soft/books), Fanza (DMM) の作品ページ。
*   **3.5.3. 機能**:
    *   対応サイトの作品ページ上で拡張機能アイコンをクリックすると、ポップアップが開く。
    *   ポップアップには、ページから自動取得した `title`, `circleName`, `authorName`, `coverImageUrl`, `productUrl` が表示される。
    *   ユーザーは取得された情報を確認し、`tags` や `status` などを追加入力して「登録」ボタンを押す。
    *   登録ボタン押下で、ログイン中のユーザーの作品としてFirestoreにデータが保存される。
    *   **（発展機能）** 購入履歴一覧ページでの一括取得機能。

### 4. 非機能要件

*   **4.1. ユーザビリティ**:
    *   各プラットフォーム（iOS/Android/Web）で一貫性のある、直感的な操作性を提供する。
    *   レスポンシブデザインを実装し、PC、タブレット、スマートフォンの各画面サイズに最適化された表示を行う。
*   **4.2. パフォーマンス**:
    *   主要な画面の表示は2秒以内に完了する。
    *   10,000件の作品データがあっても、検索・フィルタリングがストレスなく行えること。
*   **4.3. セキュリティ**:
    *   通信はすべてHTTPSで暗号化する。
    *   Firestoreのセキュリティルールを適切に設定し、ユーザーは自身のデータにのみアクセスできるよう制御する。
    *   パスワードはFirebase Authenticationの仕組みに則り、セキュアに扱う。
*   **4.4. 可用性・信頼性**:
    *   バックエンドはFirebaseのSLAに準拠する。
    *   ユーザーが登録したデータが消失しないこと。データのバックアップ/エクスポート機能を提供する。
*   **4.5. 保守性・拡張性**:
    *   コンポーネント指向で開発し、再利用性とメンテナンス性を高める。
    *   TypeScriptを導入し、型安全な開発を行う。
    *   将来的に対応プラットフォームが増えた場合でも、簡単に追加できるよう設計する。

### 5. 画面設計（UI/UX）の基本方針

*   **共通**: クリーンでミニマルなデザインを基調とする。ダークモードに対応する。
*   **スマートフォンアプリ (iOS/Android)**:
    *   ボトムタブナビゲーションを採用（例: 「ライブラリ」「検索」「設定」）。
    *   画面は縦スクロールを基本としたシングルカラムレイアウト。
*   **Webアプリケーション**:
    *   **モバイル表示**: スマートフォンアプリと同様のレイアウト。
    *   **PC表示**: 画面幅が広い場合は、左ペインに作品一覧、右ペインに選択した作品の詳細を表示するマルチカラムレイアウトを採用する。

### 6. 開発フェーズ計画

本プロジェクトは以下の2フェーズに分けて開発を進める。

*   **フェーズ1: コア機能開発 (MVPリリース)**
    *   **目標**: 手動入力で作品を管理できる、価値のあるアプリケーションを早期にリリースする。
    *   **対象機能**:
        *   ユーザー管理機能 (3.2)
        *   作品管理（CRUD）機能 (3.3)
        *   ライブラリ機能 (3.4)
        *   スマートフォンアプリ (iOS/Android) とWebアプリケーションの基本部分
        *   クラウド同期機能
*   **フェーズ2: 機能拡張**
    *   **目標**: 入力の手間を削減し、利便性を飛躍的に向上させる。
    *   **対象機能**:
        *   ブラウザ拡張機能 (3.5) の開発とリリース。
        *   フェーズ1で得たユーザーフィードバックに基づく機能改善。
        *   （検討）シリーズ管理機能、欲しいものリスト機能などの追加。